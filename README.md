# OldTube Universal Nixie Clock

Универсальные ламповые часы, поддерживающие различные газоразрядные индикаторы. Работают на базе 8-битного микроконтроллера AVR.

## Описание

Часы поддерживают от 4 до 8 газоразрядных индикаторов, таких как ИН-12, ИН-14, ИН-17 и другие. Верхние платы могут быть адаптированы для других типов индикаторов. Часы имеют приятное оранжевое свечение, отображают время, дату, температуру с датчика DS18B20 и поддерживают функцию будильника. Также реализована настраиваемая подсветка на основе адресных светодиодов WS2812E с несколькими режимами и эффектами смены цифр. Каждая лампа установлена в панельку, что позволяет легко заменить её при необходимости. Плата поддерживает до 8 ламп и точку.

Прошивка основана на доработанной версии [NixieClock_v2](https://github.com/AlexGyver/NixieClock_v2/).

Платы доступны для заказа на [OSHWLab](https://oshwlab.com/crazysova/nexie-clock-cccr_copy_copy).

## Фото и индикаторы

| Фото | Индикаторы |
| ---- | ---------- |
| ![ИН-12](photo_in12.jpg) | ИН-12 |
| ![ИН-17](photo_in17.jpg) | ИН-17 |
| ![ИН-18](photo_in18.jpg) | ИН-18 |

## Принцип работы

Микросхема MC34063 совместно с дросселем и выпрямительным диодом преобразуют входное напряжение до высокого уровня (180-200 В). Это напряжение подаётся на аноды ламп через транзисторы MMBTA92 и MMBTA42 и токоограничивающие резисторы. Для отображения определённой цифры микроконтроллер (ATmega328) формирует на своих выводах код, который подаётся на микросхему высоковольтного дешифратора К155ИД1. Дешифратор замыкает нужный вывод лампы на минус питания. Микроконтроллер по очереди через транзисторы подаёт высокое напряжение на каждую лампу с высокой частотой. Благодаря динамической индикации создаётся эффект одновременной работы всех индикаторов.

В простых конструкциях могут использоваться оптопары, но их частота переключения ниже, что может вызывать заметное мерцание. При использовании транзисторов частота переключения выше, и мерцание становится незаметным.

## Проблемы и решения

- **Самостоятельная пайка SMD компонентов** может быть сложной, особенно с использованием советского паяльника. Для разовой сборки рекомендуется использовать паяльную пасту, наносить её из шприца на контактные площадки, расставить SMD компоненты пинцетом и запечь на плите или с помощью паяльного фена. Затем запаять выводные компоненты паяльником.
- **Заказ пайки** на [JLCPCB](https://jlcpcb.com/) обойдётся примерно в 700 рублей (1$ = 65 руб).
- Для **самостоятельной сборки** большого количества плат рекомендуется заказать трафарет для паяльной пасты и наносить её шпателем.

## Возможности платы

- Подключение датчика освещённости.
- Будильник (либо 3 или 4 пункт).
- Использование ШИМ микроконтроллера для управления MOSFET вместо MC34063.
- Подключение датчика температуры DS18B20.
- Подключение до 8 анодов и 1 вывода на неоновую точку.

## Реализовано в прошивке

- Поддержка платы с индикаторами ИН-12 (4 шт.) и неоновой точкой.
- Отображение температуры с датчика DS18B20 при удержании кнопки.
- Отображение времени и настройка времени.
- Эффекты смены цифр.
- Смена режимов подсветки и её отключение.

## Пока не реализовано

- Будильник.
- Датчик освещённости.
- Датчик движения.

## Дополнительные материалы

Исходники и дополнительные материалы доступны по ссылке: [Dropbox](https://www.dropbox.com/sh/kpqx2jsb4040rfv/AADgNEK07HeK2DekBq8I7Z2Ia?dl=0).

## Управление

### Настройка времени

- **Верхняя кнопка (синяя термоусадка):**
  - Короткое нажатие: "+".
- **Средняя кнопка (красная термоусадка):**
  - Долгое нажатие: настройка времени.
  - Короткое нажатие: переключение между часами и минутами.
- **Нижняя кнопка (жёлтая термоусадка):**
  - Короткое нажатие: "-".

### Управление эффектами в режиме часов

- **Клик по средней кнопке:** останавливает и запускает перебор цветов подсветки.
- **Удержание нижней кнопки:** включает и выключает "глюки".
- **Клик по нижней кнопке:** переключает режимы подсветки ламп:
  - Дыхание.
  - Постоянное свечение.
  - Отключена.
- **Клик по верхней кнопке:** переключает режимы перелистывания цифр:
  - Без эффекта.
  - Плавное угасание.
  - Перемотка по порядку числа.
  - Перемотка по катодам.
  - Поезд.
  - Резинка.
- **Удержание верхней кнопки:** отображение температуры.

## Известные ошибки в прошивке

- При отключении WS2812 перестают переключаться эффекты смены цифр.
- При выключении "глюков" перестаёт гореть последняя лампа при использовании 8 ламп.
- На 4 и 5 режимах эффект не останавливается при использовании 8 ламп.

---
